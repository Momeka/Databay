#include <gb/gb.h>
#include "Splash.h"
#include "Utilities.h"

const unsigned char splashTileData[] = {
0x00,0x00,0x00,0x00,0x06,0x06,0x0F,0x0F,0x1F,0x1F,0x3F,0x3F,0x7F,0x7F,0xFF,0xFF,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0xE0,0xE0,0xF0,0xF0,
0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x03,0x03,0x07,0x07,0x0F,0x0F,0x1F,0x1F,
0x00,0x00,0x00,0x00,0xC0,0xC0,0xE0,0xE0,0xF0,0xF0,0xF8,0xF8,0xFC,0xFC,0xFE,0xFE,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,
0xF8,0xF8,0xFC,0xFC,0xFF,0xFF,0x7F,0x7F,0x3F,0x3F,0x1F,0x1F,0x0F,0x0F,0x07,0x07,
0x3F,0x3F,0x7F,0x7F,0xFE,0xFE,0xFC,0xFC,0xF8,0xF8,0xF0,0xF0,0xE0,0xE0,0xC0,0xC0,
0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x07,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x1C,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x03,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1E,0x1E,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF9,0xF9,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0xF0,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x3C,
0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x0F,0x0F,0x1F,0x1F,0x3F,0x3F,0x7F,0x7F,0xFC,0xFC,0xF8,0xF8,0xF0,0xF0,0xF0,0xF0,
0xE0,0xE0,0xF0,0xF0,0xF8,0xF8,0xFC,0xFC,0x7E,0x7E,0x3E,0x3E,0x1E,0x1E,0x1E,0x1E,
0x3E,0x3E,0x7F,0x7F,0xFF,0xFF,0xFF,0xFF,0xF7,0xF7,0xF3,0xF3,0xF1,0xF1,0xF0,0xF0,
0x07,0x07,0x0F,0x0F,0x9F,0x9F,0xFF,0xFF,0xFE,0xFE,0xFC,0xFC,0xF8,0xF8,0xF0,0xF0,
0xC0,0xC0,0xE0,0xE0,0xF0,0xF0,0xF1,0xF1,0xF3,0xF3,0xF7,0xF7,0xF7,0xF7,0xF7,0xF7,
0x3E,0x3E,0x7E,0x7E,0xFE,0xFE,0xF0,0xF0,0xE0,0xE0,0xC0,0xC0,0xFC,0xFC,0xFC,0xFC,
0xF9,0xF9,0xF1,0xF1,0xF1,0xF1,0xF3,0xF3,0xF7,0xF7,0xFF,0xFF,0xFF,0xFF,0xFE,0xFE,
0xF0,0xF0,0xF0,0xF0,0xF1,0xF1,0xE3,0xE3,0xC7,0xC7,0x87,0x87,0x07,0x07,0x07,0x07,
0x7E,0x7E,0xFF,0xFF,0xFF,0xFF,0xE7,0xE7,0xC3,0xC3,0xC3,0xC3,0xC3,0xC3,0xC3,0xC3,
0x00,0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFF,0xFF,0x7F,0x7F,0x3F,0x3F,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x03,0x03,0x07,0x07,
0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFC,0xFC,0xF8,0xF8,
0xF0,0xF0,0xF0,0xF0,0xF8,0xF8,0xFC,0xFC,0x7F,0x7F,0x3F,0x3F,0x1F,0x1F,0x0F,0x0F,
0x1E,0x1E,0x1E,0x1E,0x3E,0x3E,0x7E,0x7E,0xFC,0xFC,0xF8,0xF8,0xF0,0xF0,0xE0,0xE0,
0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,
0x60,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xF7,0xF7,0xF7,0xF7,0xF7,0xF7,0xF3,0xF3,0xF1,0xF1,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,
0xFC,0xFC,0xC0,0xC0,0xE0,0xE0,0xF0,0xF0,0xFE,0xFE,0xFE,0xFE,0x7E,0x7E,0x3E,0x3E,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF7,0xF7,0xF3,0xF3,0xF1,0xF1,0xF1,0xF1,0xF1,0xF1,
0x07,0x07,0x87,0x87,0xC7,0xC7,0xE7,0xE7,0xF7,0xF7,0xF7,0xF7,0xF7,0xF7,0xF7,0xF7,
0xC3,0xC3,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xC3,0xC3,0xC3,0xC3,0xC3,0xC3,
0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0
};

const unsigned char splashMap[] = {
0x00,0x01,0x02,0x03,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,
0x05,0x06,0x07,0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F,0x10,0x11,0x04,0x04,
0x08,0x12,0x13,0x08,0x14,0x15,0x16,0x17,0x18,0x19,0x1A,0x1B,0x1C,0x1D,0x04,
0x1E,0x1F,0x20,0x21,0x22,0x23,0x24,0x25,0x26,0x27,0x28,0x29,0x2A,0x2B,0x04
};

const unsigned char splashSprites[] = {
0x00,0x00,0x00,0x00,0x45,0x45,0x45,0x45,0x45,0x45,0x55,0x55,0x6D,0x6D,0x00,0x00,
0x00,0x00,0x00,0x00,0x14,0x14,0x14,0x14,0x14,0x14,0x55,0x55,0xB6,0xB6,0x00,0x00,
0x00,0x00,0x00,0x00,0x46,0x46,0x45,0x45,0x44,0x44,0x44,0x44,0xD4,0xD4,0x00,0x00,
0x00,0x00,0x00,0x00,0xDD,0xDD,0x55,0x55,0x55,0x55,0x55,0x55,0x5D,0x5D,0x00,0x00,
0x00,0x00,0x00,0x00,0xB7,0xB7,0x54,0x54,0x16,0x16,0x14,0x14,0x17,0x17,0x00,0x00,
0x00,0x00,0x00,0x00,0x57,0x57,0x55,0x55,0x65,0x65,0x57,0x57,0x55,0x55,0x00,0x00,
0x00,0x00,0x00,0x00,0x1D,0x1D,0x11,0x11,0x11,0x11,0x11,0x11,0x5D,0x5D,0x00,0x00,
0x00,0x00,0x00,0x00,0xDB,0xDB,0x55,0x55,0x51,0x51,0x51,0x51,0xD1,0xD1,0x00,0x00
};

const unsigned char moveLookUp[] = {
60,60,60,60,60,60,60,60,61,61,
61,62,62,62,63,63,64,64,65,65,
66,67,68,69,70,71,72,73,74,75,
76,78,80,82,84,86,89,90,91,92,
93,94,95,96,96,97,97,98,98,99,
99,99,100,100,100,101,101,101,102,102,
102,103
};


void Initialize_splash(void)
{
	UBYTE x, y = 0;

	DISPLAY_OFF;
	HIDE_SPRITES;
	HIDE_BKG;

	set_bkg_data(0, 44, &splashTileData);
	for(x = 0; x != 32; x++)
	{
		for(y = 0; y != 18; y++)
		{
			set_bkg_tiles(x, y, 1, 1, 0x04);
		}
	}

	for(x = 0; x != 4; x++)
	{
		for(y = 0; y != 4; y++)
		{
			set_bkg_tiles(16 + x, 6 + y, 1, 1, &splashMap[x + (y * 15)]);
		}
	}

	SCX_REG = moveLookUp[0];

	OBP0_REG = OBP1_REG = 0x20;
	set_sprite_data(0, 8, &splashSprites);
	for(x = 0; x != 8; x++)
	{
		set_sprite_tile(x, x);
		move_sprite(x, 62 + (x << 3), 96);
	}

	SHOW_BKG;
	SHOW_SPRITES;
	DISPLAY_ON;
}

UBYTE Run_splash(void)
{
	UBYTE stage 	= 0;
	UBYTE counter 	= 0;

	Initialize_splash();
	Fade_in();

	while(1)
	{
		switch(stage)
		{
			case 0:
			{
				delay(700);
				stage++;
			} break;
			case 1:
			{
				if(counter != 61)
				{
					counter++;
					SCX_REG = moveLookUp[counter];
				}
				else
				{
					delay(150);
					set_bkg_tiles(16, 6, 15, 4, &splashMap);
					stage++;
					break;
				}
				delay(10);
			} break;
			case 2:
			{
				delay(500);
				OBP0_REG = OBP1_REG = 0x60;
				delay(50);
				OBP0_REG = OBP1_REG = 0xA4;
				delay(50);
				OBP0_REG = OBP1_REG = 0xE4;
				delay(500);
				stage++;
			}break;
			case 3:
			{
				delay(1500);
				Reset_sprites();
				Fade_out(); 
				SCX_REG = 0;
				return 2;
			}break;
		}
	}

	return 3;
}